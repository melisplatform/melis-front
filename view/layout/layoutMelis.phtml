<?php echo $this->content; ?>
<!-- Rendered with Melis CMS V2 - <?= date("Y-m-d H:i:s"); ?> -->

<script type="text/javascript">

    var jQueryChecker = null;
    var melisActivePageId = window.parent.$("#"+parent.activeTabId).find("iframe").data("iframe-id");
    
    <?php
    /**
     * This JS function will check if JQuery is already added in the template
     * currently being edited as adding a new one would destroy instances already created.
     * If no JQuery, then we add it.
     */
    ?>
    function loadScript(url, callback)
    {
        var body = document.getElementsByTagName('body')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = url;
        script.onreadystatechange = callback;
        script.onload = callback;
        body.appendChild(script);
    }

    function loadLayoutScripts()
    {
        var jQueryChecker = setTimeout(function(){
            if(window.jQuery !== undefined) {
                loadScript("/MelisCore/js/library/tinymce/tinymce.min.js");
                loadScript("/MelisCore/js/tinyMCE/tinymce_cleaner.js");
                loadScript("/MelisCore/js/tinyMCE/melis_tinymce.js");
                loadScript("/MelisCms/js/tools/findpage.tool.js");
                loadScript("/MelisCms/js/plugins/plugins.edition.js");

                clearTimeout(jQueryChecker);
            }

        }, 300);
    }

    window.onload = function() {
        if ('undefined' == typeof window.jQuery) {
            loadScript("/MelisCore/assets/components/library/jquery/jquery.min.js?v=v1.2.3");
        }
        // loadLayoutScripts();
        
        // disable all links in preview page       
        $('a').click(function(event) { event.preventDefault(); });

        // disable all form submitting in preview page
        $('form').submit(false);
    }
</script>

<script type="text/javascript" src="/MelisCore/js/library/tinymce/tinymce.min.js"></script>
<script type="text/javascript" src="/MelisCore/js/tinyMCE/tinymce_cleaner.js"></script>
<script type="text/javascript" src="/MelisCore/js/tinyMCE/melis_tinymce.js"></script>
<script type="text/javascript" src="/MelisFront/js/melisfront_tinycme.js"></script>
<script type="text/javascript" src="/MelisCms/js/tools/findpage.tool.js"></script>
<script type="text/javascript" src="/MelisCms/js/plugins/plugins.edition.js"></script>
<script type="text/javascript" src="/melis/MelisCore/Language/getTranslations"></script>
<?php
    foreach ($this->assets['css']as $css)
        echo '<link href="' . $css . '" media="screen" rel="stylesheet" type="text/css">' . "\n";

    foreach ($this->assets['js']as $js)
        echo '<script type="text/javascript" src="' . $js . '"></script>' . "\n";

    echo $this->pluginsMenu;

?>