<?php
$data_dragdropzone_id = " data-dragdropzone-id='$this->dragdropzoneId'";

$pluginId = '';
if (!empty($this->pluginFrontConfig) && !empty($this->pluginFrontConfig['id']))
    $pluginId = $this->pluginFrontConfig['id'];
?>

<div class="melis-dragdropzone-container" title="<?= $this->dragdropzoneId; ?>"
    data-dragdropzone-id="<?= $this->dragdropzoneId; ?>"
    data-after="<?= $this->dragDropLabel; ?>"
    data-module="<?= $this->configPluginKey; ?>"
    data-plugin="<?= $this->pluginName; ?>"
    data-plugin-id="<?= $pluginId; ?>"
    data-melis-tag="<?= $this->pluginXmlDbKey; ?>"
    data-layout-template="<?= $this->dndLayoutTemplate; ?>"
    data-plugin-referer="<?= $this->dndPluginReferer; ?>"
    data-site-module="<?= $this->siteModule; ?>">
    <div class="dnd-layout-wrapper">
        <div class="dnd-layout-indicator melis-plugin-indicator">
            <img src="/MelisFront/images/icons/dnd-icon.png" alt="dragndrop icon" width="25" height="25" />
        </div>
        <div class="dnd-layout-buttons melis-plugin-tools-box">
            <div class="melis-plugin-title-box">
                <span class="melis-dnd-title melis-module-title">DND Zone</span>
                <span class="melis-dnd-sub-title melis-plugin-title">Layout</span>
            </div>
            <?= $this->partial('MelisFront/dragdropzone/meliscontainer-buttons'); ?>
            <div class="dnd-plugin-sub-tools">
                <button class="btn dnd-plus-button" data-page-id="<?= $this->pageId; ?>" data-dnd-id="<?= $pluginId ?>" data-melis-site="<?= $this->siteModule; ?>">
                    <i class="fa fa-plus"></i>
                </button>
                <?php if (!empty($this->dndPluginReferer)) { ?>
                    <button class="btn dnd-remove-button" data-page-id="<?= $this->pageId; ?>" data-dnd-id="<?= $pluginId ?>">
                        <i class="fa fa-trash"></i>
                    </button>
                <?php } ?>
                <button class="btn dnd-arrow-down">
                    <i class="fa fa-caret-down"></i>
                </button>
                <button class="btn dnd-arrow-up">
                    <i class="fa fa-caret-up"></i>
                </button>
            </div>
        </div>
        <div class="<?= $this->hasDragDropZone ? '' : 'melis-dragdropzone' ?> no-content"
            data-dragdropzone-id="<?= $this->dragdropzoneId; ?>"
            data-after="<?= $this->dragDropLabel; ?>"
            data-module="<?= $this->configPluginKey; ?>"
            data-plugin="<?= $this->pluginName; ?>"
            data-plugin-id="<?= $pluginId ?>"
            data-melis-tag="<?= $this->pluginXmlDbKey; ?>"
            data-site-module="<?= $this->siteModule; ?>">
            <?php
            echo $this->viewFront;
            ?>
        </div>
    </div>

    <!-- <script>
        setTimeout(() => {

                // $("body .melis-dragdropzone-container .dnd-plus-button").off().click(function() {

                //     let btn = $(this);
                //     let pageId = $(this).data("pageId");
                //     let dndId = $(this).data("dndId");
                //     let melisSite = $(this).data("melisSite");
                //     let dndTpl = "default";
                //     let pluginContent = btn.closest(".dnd-plugins-content");

                //     btn.attr("disabled", true);

                //     $.get("/dnd-layout", {
                //         pageId,
                //         dndId,
                //         dndTpl,
                //         melisSite,
                //         addAction: true
                //     }).done((res) => {

                //         btn.attr("disabled", false);

                //         if (res.success) {

                //             let newDnd = $(res.html);
                //             newDnd.appendTo(pluginContent);

                //             // $('html, body').animate({
                //             //     scrollTop: newDnd.offset().top
                //             // }, 2000);

                //             let boHeader = 47;
                //             let pageEditionHeader = 72;
                //             let newDndTop = newDnd.offset().top;
                //             let xtra = 100;

                //             $(parent.document).scrollTop(newDndTop + xtra);


                //             let newDndId = newDnd.find(".melis-dragdropzone-container").data("pluginId");

                //             melisPluginEdition.moveResponsiveClass();
                //             melisPluginEdition.pluginDetector();
                //             melisPluginEdition.initResizable();
                //             melisDragnDrop.setDragDropZone();

                //             // save change to session
                //             melisPluginEdition.sendDragnDropList(newDndId, pageId);

                //         }
                //     })
                // })


                // $("body .melis-dragdropzone-container .dnd-remove-button").off().click(function() {

                //     let btn = $(this);
                //     let pageId = $(this).data("pageId");
                //     let dndId = $(this).data("dndId");

                //     btn.attr("disabled", true);

                //     let dndContainer = btn.closest(".melis-dragdropzone-container");

                //     $.post("/dnd-remove", {
                //         pageId,
                //         dndId,
                //     }).done((res) => {
                //         dndContainer.remove();
                //     });

                // });
            },
            3000)
    </script> -->
</div>